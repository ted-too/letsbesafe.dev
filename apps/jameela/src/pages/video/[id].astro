---
import Layout from "../../Layout.astro";
import getTheme from "ui/utils/getTheme";
import invariant from "tiny-invariant";
import YouTube from "youtube-sr";
import SearchForm from "../../components/search-form";
import VideoPage from "../../components/video-page/page";

const theme = getTheme(Astro);

const id = Astro.params.id?.toString() || "";
try {
  invariant(id);
  invariant(YouTube.validate(id, "VIDEO_ID"));
} catch (err) {
  return Astro.redirect("/404");
}

const data = await YouTube.searchOne(`http://www.youtube.com/watch?v=${id}`);
---

<Layout theme={theme}>
  <SearchForm client:visible />
  <VideoPage data={data} client:visible />
</Layout>
